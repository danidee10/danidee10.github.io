<!DOCTYPE html>
<html>
    <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Flask by example 7 (Spin up an Admin dashboard quickly and easily with Flask-Admin)</title>
    <meta name="description" content="Osaetin Daniel's blog">
    <link rel="alternate" type="application/atom+xml" title="Osaetin Daniel" href="/feed.xml" />

    <!--script src="https://use.typekit.net/axu2jbv.js"></script>
    <script>try{Typekit.load({ async: true });}catch(e){}</script-->
    <!--link href="https://fonts.googleapis.com/css?family=Cabin" rel="stylesheet"-->
    <link href="https://fonts.googleapis.com/css?family=Josefin+Sans" rel="stylesheet">
    <script src="https://use.fontawesome.com/5bbf16a3a0.js"></script>

    <style>
    /*!
 * end2end - jekyll theme free
 * https://github.com/nandomoreirame/end2end
 * MIT License
 */@import url("//fonts.googleapis.com/css?family=Open+Sans:400,300,700");html{box-sizing:border-box}*,*::after,*::before{box-sizing:inherit}html,body,div,span,applet,object,iframe,h1,h2,h3,h4,h5,h6,p,blockquote,pre,a,abbr,acronym,address,big,cite,code,del,dfn,em,img,ins,kbd,q,s,samp,small,strike,strong,sub,sup,tt,var,b,u,i,center,dl,dt,dd,ol,ul,li,fieldset,form,label,legend,table,caption,tbody,tfoot,thead,tr,th,td,article,aside,canvas,details,embed,figure,figcaption,footer,header,hgroup,menu,nav,output,ruby,section,summary,time,mark,audio,video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}article,aside,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}body{line-height:1}ol,ul{list-style:none}blockquote,q{quotes:none}blockquote:before,blockquote:after,q:before,q:after{content:'';content:none}table{border-collapse:collapse;border-spacing:0}.btn,.sliding-panel-button{appearance:none;background-color:#337ab7;border:0;border-radius:3px;color:#fff;cursor:pointer;display:inline-block;font-family:"Open Sans","Helvetica Neue","Helvetica","Roboto","Arial",sans-serif;font-size:1em;-webkit-font-smoothing:antialiased;font-weight:600;line-height:1;padding:.75em 1.5em;text-decoration:none;transition:background-color .2s ease;user-select:none;vertical-align:middle;white-space:nowrap}.btn:hover,.sliding-panel-button:hover,.btn:focus,.sliding-panel-button:focus{background-color:#296292;color:#fff}.btn:disabled,.sliding-panel-button:disabled{cursor:not-allowed;opacity:0.5}.btn:disabled:hover,.sliding-panel-button:disabled:hover{background-color:#337ab7}fieldset{background-color:#f7f7f7;border:1px solid #dedede;margin:0 0 .75em;padding:1.5em}input,label,select{display:block;font-family:"Open Sans","Helvetica Neue","Helvetica","Roboto","Arial",sans-serif;font-size:1em}label{font-weight:600;margin-bottom:.375em}label.required::after{content:"*"}label abbr{display:none}input[type="color"],input[type="date"],input[type="datetime"],input[type="datetime-local"],input[type="email"],input[type="month"],input[type="number"],input[type="password"],input[type="search"],input[type="tel"],input[type="text"],input[type="time"],input[type="url"],input[type="week"],input:not([type]),textarea,select[multiple=multiple]{background-color:#fff;border:1px solid #dedede;border-radius:3px;box-shadow:inset 0 1px 3px rgba(0,0,0,0.06);box-sizing:border-box;font-family:"Open Sans","Helvetica Neue","Helvetica","Roboto","Arial",sans-serif;font-size:1em;margin-bottom:.75em;padding:.5em;transition:border-color .2s ease;width:100%}input[type="color"]:hover,input[type="date"]:hover,input[type="datetime"]:hover,input[type="datetime-local"]:hover,input[type="email"]:hover,input[type="month"]:hover,input[type="number"]:hover,input[type="password"]:hover,input[type="search"]:hover,input[type="tel"]:hover,input[type="text"]:hover,input[type="time"]:hover,input[type="url"]:hover,input[type="week"]:hover,input:not([type]):hover,textarea:hover,select[multiple=multiple]:hover{border-color:#b2b2b2}input[type="color"]:focus,input[type="date"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,input[type="email"]:focus,input[type="month"]:focus,input[type="number"]:focus,input[type="password"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="text"]:focus,input[type="time"]:focus,input[type="url"]:focus,input[type="week"]:focus,input:not([type]):focus,textarea:focus,select[multiple=multiple]:focus{border-color:#337ab7;box-shadow:inset 0 1px 3px rgba(0,0,0,0.06),0 0 5px rgba(45,109,163,0.7);outline:none}input[type="color"]:disabled,input[type="date"]:disabled,input[type="datetime"]:disabled,input[type="datetime-local"]:disabled,input[type="email"]:disabled,input[type="month"]:disabled,input[type="number"]:disabled,input[type="password"]:disabled,input[type="search"]:disabled,input[type="tel"]:disabled,input[type="text"]:disabled,input[type="time"]:disabled,input[type="url"]:disabled,input[type="week"]:disabled,input:not([type]):disabled,textarea:disabled,select[multiple=multiple]:disabled{background-color:#f2f2f2;cursor:not-allowed}input[type="color"]:disabled:hover,input[type="date"]:disabled:hover,input[type="datetime"]:disabled:hover,input[type="datetime-local"]:disabled:hover,input[type="email"]:disabled:hover,input[type="month"]:disabled:hover,input[type="number"]:disabled:hover,input[type="password"]:disabled:hover,input[type="search"]:disabled:hover,input[type="tel"]:disabled:hover,input[type="text"]:disabled:hover,input[type="time"]:disabled:hover,input[type="url"]:disabled:hover,input[type="week"]:disabled:hover,input:not([type]):disabled:hover,textarea:disabled:hover,select[multiple=multiple]:disabled:hover{border:1px solid #dedede}textarea{resize:vertical}input[type="search"]{appearance:none}input[type="checkbox"],input[type="radio"]{display:inline;margin-right:.375em}input[type="checkbox"]+label,input[type="radio"]+label{display:inline-block}input[type="file"]{margin-bottom:.75em;width:100%}select{margin-bottom:1.5em;max-width:100%;width:auto}ul,ol{margin:0;padding:0;list-style-position:inside;padding-left:25px}dl{margin-bottom:.75em}dl dt{font-weight:bold;margin-top:.75em}dl dd{margin:0}table{border-collapse:collapse;font-feature-settings:"kern", "liga", "tnum";margin:.75em 0;table-layout:fixed;width:100%}th{border-bottom:1px solid #a7a7a7;font-weight:600;padding:.75em 0;text-align:left}td{border-bottom:1px solid #dedede;padding:.75em 0}tr,td,th{vertical-align:middle}body{color:#000000;font-size:18px;font-weight:400;line-height:1.5}h1,h2,h3,h4,h5,h6{font-family:"Open Sans","Helvetica Neue","Helvetica","Roboto","Arial",sans-serif;font-size:1em;line-height:1.2;font-weight:700;margin:0 0 .75em}h1{font-size:35px; color: #337ab7;}h2{font-size:1.625rem}h3{font-size:1.5rem}h4{font-size:1.25rem}h5,h6{font-size:1rem}p{margin:0 0 .75em;font-weight:300}em{font-style:italic}small{font-size:80%}a{color:#337ab7;text-decoration:none;-webkit-transition:color .2s ease;-moz-transition:color .2s ease;transition:color .2s ease}a:active,a:focus,a:hover{color:#265c89}hr{border-bottom:1px solid #dedede;border-left:0;border-right:0;border-top:0;margin:1.5em 0}img,picture{margin:0;max-width:100%}code{background:none;border-radius:0;border:none;font-family:"Courier New", monospace;font-size:0.9em;margin:0;padding:0 5px;background-color:#ededed}pre{-webkit-overflow-scrolling:touch;font-family:"Courier New", monospace;font-size:0.9em;margin:0}pre code{line-height:1.75em}.txt-primary{color:#337ab7}.txt-white{color:#fff}.txt-black{color:#000}.txt-blue{color:#477dca}.txt-dark-gray{color:#232323}.txt-medium-gray{color:#9a9a9a}.txt-light-gray{color:#dedede}.txt-left{text-align:left}.txt-right{text-align:right}.txt-center{text-align:center}.txt-justify{text-align:justify}.word-wrap{overflow-wrap:break-word;word-wrap:break-word;word-break:break-all}.dot{border-radius:50%}blockquote{background:#f9f9f9;border-left:10px solid #ccc;margin:1.5em 10px;padding:0.5em 10px;quotes:"“" "”" "‘" "’"}blockquote:before{color:#ccc;content:open-quote;font-size:4em;line-height:0.1em;margin-right:0.25em;vertical-align:-0.4em}blockquote p{display:inline}.site-header::after,.social::after,.pagination::after,.highlight::after{clear:both;content:"";display:table}html,body{min-height:100%;height:100%}body{border-top:5px solid #337ab7;background:#fff url("/images/bg-pattern1.png.png")}.container{max-width:800px;margin-left:auto;margin-right:auto;padding-left:.75em;padding-right:.75em}.container::after{clear:both;content:"";display:table}.card,.post-list .post{background-color:#fff;box-shadow:0 2px 1px rgba(0,0,0,0.1);margin:0 0 1.5em;padding:1.5em .75em}@media screen and (min-width: 480px){.card,.post-list .post{padding:1.5em}}.site-header{background-color:#fff;padding:0.3em 0;margin-bottom:1.5em;border-bottom:1px solid rgba(222,222,222,0.5)}.site-header h1{margin:0;padding:5px 0;float:left;font-weight:400;font-size:1.25rem}.site-header h1 span{color:#337ab7}.site-header h1,.site-header a{text-transform:lowercase}.site-header .navbar{float:right}.site-header a{color:#9a9a9a}.site-header a:hover,.site-header a:focus,.site-header a:active{color:#232323}@media screen and (max-width: 480px){.site-header .container{padding-left:1.5em;padding-right:1.5em}}.sliding-panel-button{float:right;padding:5px;margin:0 3.75em 0 0}.sliding-panel-button span{width:30px;display:block;height:3px;border-radius:2px;background:#fff;margin:3px 0}@media screen and (min-width: 480px){.sliding-panel-button{display:none}}@media screen and (max-width: 480px){.sliding-panel-content{border-top:5px solid #337ab7;position:fixed;top:0;right:auto;bottom:0;left:0;height:100%;width:220px;-webkit-transform:translateX(-100%);-moz-transform:translateX(-100%);-ms-transform:translateX(-100%);-o-transform:translateX(-100%);transform:translateX(-100%);-webkit-transition:all 0.25s linear;-moz-transition:all 0.25s linear;transition:all 0.25s linear;background:#fff;-webkit-overflow-scrolling:touch;overflow-y:auto;z-index:999999}.sliding-panel-content.is-visible{-webkit-transform:translateX(0);-moz-transform:translateX(0);-ms-transform:translateX(0);-o-transform:translateX(0);transform:translateX(0)}.sliding-panel-fade-screen{position:fixed;top:0;right:0;bottom:0;left:0;-webkit-transition:all 0.15s ease-out 0s;-moz-transition:all 0.15s ease-out 0s;transition:all 0.15s ease-out 0s;background:#000;opacity:0;visibility:hidden;z-index:9999}.sliding-panel-fade-screen.is-visible{opacity:0.4;visibility:visible}.sliding-panel-close{cursor:pointer}}.navbar li,.navbar a{display:inline-block}.navbar a{padding:5px 15px}@media screen and (max-width: 600px){.navbar a{padding:5px 10px}}@media screen and (max-width: 480px){.navbar li,.navbar a{display:block;text-align:center}.navbar li{border-bottom:1px solid #f2f2f2}.navbar a{padding:15px 0}}.btn.btn-ghost,.btn-ghost.sliding-panel-button{background-color:transparent;border:2px solid #337ab7;color:#337ab7;margin-bottom:2px}.btn.disabled,.disabled.sliding-panel-button,.btn[disabled],[disabled].sliding-panel-button,fieldset[disabled] .btn,fieldset[disabled] .sliding-panel-button{cursor:not-allowed;filter:alpha(opacity=65);-webkit-box-shadow:none;box-shadow:none;opacity:.65}body.home{width:100%;display:table}.hero{text-align:center;display:table-cell;vertical-align:middle}.hero-inner{text-align:center;display:inline-block;padding:1.5em}.hero-inner .dot{padding:5px;border:1px solid #dedede}.hero-inner h1{margin-top:.7em;font-size:2.5rem}.hero-inner h3{font-size:1.25rem;margin:.8em 0 1.2em}@media screen and (min-width: 600px){.hero-inner h3{font-size:1.5rem}}.hero-inner h3,.hero-inner em{font-weight:300}.hero-inner em{color:#337ab7}.hero-inner strong{font-weight:700}.post{padding:1.5em 0}.post-header{margin-bottom:1.5em; padding-bottom: 5px; border-bottom: 1px solid #999;}.post-title{font-size:1.625rem;margin-bottom:0;line-height:1.5em}.post-list .post a{color:#636363}.post-list .post a:hover,.post-list .post a:active,.post-list .post a:focus{color:#337ab7}.social{padding:1.5em 0}.social li{display:inline-block;padding:0 .6em}.social a{color:#9a9a9a}.social a:hover,.social a:active,.social a:focus{color:#337ab7}.social i{font-size:1.2em}.pagination{text-align:center;margin:2em 0}.pagination li{padding:0 .4em}.pagination li,.pagination a,.pagination span{display:inline-block}.pagination a,.pagination span{line-height:1.2em;font-size:.75rem}.pagination .btn,.pagination .sliding-panel-button{color:#636363;border-color:rgba(222,222,222,0.8)}.pagination span{color:#aaa;font-style:italic}.site-footer{background-color:#fff;border-top:1px solid rgba(222,222,222,0.5);padding:1.5em;text-align:center}.site-footer p{margin:0}.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width: 500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}@font-face{font-family:"end2end-icons";src:url("../fonts/end2end-icons.eot?vs69d0");src:url("../fonts/end2end-icons.eot?vs69d0#iefix") format("embedded-opentype"),url("../fonts/end2end-icons.ttf?vs69d0") format("truetype"),url("../fonts/end2end-icons.woff?vs69d0") format("woff"),url("../fonts/end2end-icons.svg?vs69d0#end2end-icons") format("svg");font-weight:normal;font-style:normal}.icon{font-family:"end2end-icons" !important;speak:none;font-style:normal;font-weight:normal;font-variant:normal;text-transform:none;line-height:1;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-home:before{content:""}.icon-comments:before{content:""}.icon-comment-o:before{content:""}.icon-comments-o:before{content:""}.icon-search:before{content:""}.icon-share:before{content:""}.icon-google-plus:before{content:""}.icon-facebook:before{content:""}.icon-facebook-rounded:before{content:""}.icon-twitter:before{content:""}.icon-twitter-rounded:before{content:""}.icon-feed:before{content:""}.icon-github:before{content:""}.icon-linkedin:before{content:""}.highlight{padding:0;margin-top:1.2em;margin-bottom:1.2em}.highlight,.highlight .hll,.highlight pre,.highlight code{background-color:#272822 !important;border:none}.highlight pre{margin:0;padding:1.3em;white-space:pre;line-height:23px;overflow-x:auto;margin-bottom:0;word-break:inherit;word-wrap:inherit}.highlight pre,.highlight pre code{color:#eeffdd}.highlight pre code{white-space:pre;padding:0 !important}.highlight pre code *{white-space:nowrap}.highlight .c{color:#75715e}.highlight .err{color:#f2f1f2}.highlight .k{color:#66d9ef}.highlight .l{color:#ae81ff}.highlight .n{color:#f8f8f2}.highlight .o{color:#f92672}.highlight .p{color:#f8f8f2}.highlight .cm{color:#75715e}.highlight .cp{color:#75715e}.highlight .c1{color:#75715e}.highlight .cs{color:#75715e}.highlight .ge{font-style:italic}.highlight .gs{font-weight:bold}.highlight .kc{color:#66d9ef}.highlight .kd{color:#66d9ef}.highlight .kn{color:#f92672}.highlight .kp{color:#66d9ef}.highlight .kr{color:#66d9ef}.highlight .kt{color:#66d9ef}.highlight .ld{color:#e6db74}.highlight .m{color:#ae81ff}.highlight .s{color:#e6db74}.highlight .na{color:#a6e22e}.highlight .nb{color:#f8f8f2}.highlight .nc{color:#a6e22e}.highlight .no{color:#66d9ef}.highlight .nd{color:#a6e22e}.highlight .ni{color:#f8f8f2}.highlight .ne{color:#a6e22e}.highlight .nf{color:#a6e22e}.highlight .nl{color:#f8f8f2}.highlight .nn{color:#f8f8f2}.highlight .nx{color:#a6e22e}.highlight .py{color:#f8f8f2}.highlight .nt{color:#f92672}.highlight .nv{color:#f8f8f2}.highlight .ow{color:#f92672}.highlight .w{color:#f8f8f2}.highlight .mf{color:#ae81ff}.highlight .mh{color:#ae81ff}.highlight .mi{color:#ae81ff}.highlight .mo{color:#ae81ff}.highlight .sb{color:#e6db74}.highlight .sc{color:#e6db74}.highlight .sd{color:#e6db74}.highlight .s2{color:#e6db74}.highlight .se{color:#ae81ff}.highlight .sh{color:#e6db74}.highlight .si{color:#e6db74}.highlight .sx{color:#e6db74}.highlight .sr{color:#e6db74}.highlight .s1{color:#e6db74}.highlight .ss{color:#e6db74}.highlight .bp{color:#f8f8f2}.highlight .vc{color:#f8f8f2}.highlight .vg{color:#f8f8f2}.highlight .vi{color:#f8f8f2}.highlight .il{color:#ae81ff}.highlight .gu{color:#75715e}.highlight .gd{color:#f92672}.highlight .gi{color:#a6e22e}

body {
  /*font-family: brandon-grotesque, "Brandon Grotesque", "Helvetica Neue", Helvetica, Arial, "Lucida Sans", Geneva, Verdana, sans-serif; */
  font-family: 'Josefin Sans', sans-serif;
  font-size: 20px;
}

.container {
  max-width: 950px;
}

.post-meta {
  font-style: italic;
  font-size: 16px;
}

strong {
  font-weight: bold;
}

a {
  font-weight: bold;
}

.postlist {
  list-style: inside;
  font-style: italic;
}

    </style>

    <link rel="canonical" href="http://localhost:4000/2016/11/14/flask-by-example-7.html">

    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-83888894-1', 'auto');
      ga('send', 'pageview');

    </script>

  </head>


    <main>
      <header class="site-header">
  <div class="container">
    <h1><a href="/">Osaetin<span>Daniel</span></a></h1>

    <button type="button" class="sliding-panel-button">
      <span></span>
      <span></span>
      <span></span>
    </button>

    <nav class="navbar sliding-panel-content">
      <ul>

          <li><a href="/about" title="About">About</a></li>

          <li><a href="/blog" title="Blog">Blog</a></li>

        <!--rssfeed li><a href="/end2end/feed.xml" target="_blank"><i class="icon icon-feed"></i></a></li-->
      </ul>
    </nav>
  </div>
</header>


      <div class="sliding-panel-fade-screen"></div>

      <div class="container">
        <article role="article" class="post">
          <div class="card">
            <header class="post-header">
              <h1 class="post-title">Flask by example 7 (Spin up an Admin dashboard quickly and easily with Flask-Admin)</h1>
              <p class="post-meta">November 14, 2016</i>
            </header>

            <div class="post-content">
              <p>Welcome to part 7 of this tutorial, in this part we’re going to build an admin dashboard for our application which would serve provide basic <code class="highlighter-rouge">CRUD</code> functionality for the models in our database.</p>

<p>Go ahead and install flask admin from pip</p>

<figure class="highlight"><pre><code class="language-shell" data-lang="shell">pip install flask-admin</code></pre></figure>

<p>It’s very easy to use flask-admin, just import the <code class="highlighter-rouge">Admin</code> class, create a new object out of it, and set the application to our current application</p>

<p>After that you can add different models by “adding” new <code class="highlighter-rouge">ModelView</code> objects to the application.</p>

<p>This <code class="highlighter-rouge">ModelView</code> objects would show up as different menu’s in our admin dashboard</p>

<p><strong>Add the following to votr.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask_admin</span> <span class="kn">import</span> <span class="n">Admin</span>
<span class="kn">from</span> <span class="nn">flask_admin.contrib.sqla</span> <span class="kn">import</span> <span class="n">ModelView</span>

<span class="n">admin</span> <span class="o">=</span> <span class="n">Admin</span><span class="p">(</span><span class="n">votr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'Dashboard'</span><span class="p">)</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">ModelView</span><span class="p">(</span><span class="n">Users</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">))</span></code></pre></figure>

<p>reload the page and open <code class="highlighter-rouge">localhost:5000/admin</code></p>

<p>You should see a a blank page that tells you Your “Login was successful” and a plain navbar that looks like this</p>

<p><img src="/images/flask-7-navbar.png" alt="flask-7-navbar" /></p>

<p>You can add your models and play around the the admin. create, delete and modify records as you please</p>

<h2 id="adding-authentication-to-flask-admin">Adding authentication to flask admin</h2>
<p>After playing around with flask admin, you’d have noticed that something very important is missing…<strong>Authentication</strong></p>

<p>Now, there are several ways of adding authentication to flask admin, but i’m going to show you how to integrate our Authentication system with flask admin.</p>

<p>First of all, it would make more sense to keep all our “admin stuff” in a separate file in order to keep the main application file clean. Let’s call that admin file <strong>admin.py</strong></p>

<p>Flask admin provides a way of “hiding” models from users based on any condition we like, this is very useful in building role-based admin interfaces, For example a cashier might have access to the post transactions but he should not be able to see the total transactions posted for the day (Which contains other entries posted by other cashiers), Only the manager should be able to see that</p>

<p>To add this feature, we have to inherit the <code class="highlighter-rouge">ModelView</code> class and override two methods</p>

<p><strong>place the following in the admin.py file</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask_admin.contrib.sqla</span> <span class="kn">import</span> <span class="n">ModelView</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">request</span>


<span class="k">class</span> <span class="nc">AdminView</span><span class="p">(</span><span class="n">ModelView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static_folder</span> <span class="o">=</span> <span class="s">'static'</span>

    <span class="k">def</span> <span class="nf">is_accessible</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'user'</span><span class="p">)</span> <span class="o">==</span> <span class="s">'Administrator'</span>

    <span class="k">def</span> <span class="nf">inaccessible_callback</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_accessible</span><span class="p">():</span>
            <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">url_for</span><span class="p">(</span><span class="s">'home'</span><span class="p">,</span> <span class="nb">next</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">url</span><span class="p">))</span></code></pre></figure>

<p>The <strong>is_accessible</strong> method determines if a model is accessible or not, based on a particular condition, in our case we only want to show the model to the current user, if they’re logged in and their username equals <strong>“Administrator”</strong></p>

<p>In the <strong>inaccessible_callback</strong> method, we’re simply saying if the model is not accessible redirect the user back to the homepage. The next argument is used to take the admin user back to the last page they tried to access.</p>

<p>To make use of this parameter, just change the return statement in your login route to:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="n">request</span><span class="o">.</span><span class="n">args</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">'next'</span><span class="p">)</span> <span class="ow">or</span> <span class="n">url_for</span><span class="p">(</span><span class="s">'home'</span><span class="p">))</span></code></pre></figure>

<p>and the url the login form on the homepage points to:</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;form</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">action=</span><span class="s">"{{ url_for('login', next=request.args.get('next')) }}"</span><span class="nt">&gt;</span></code></pre></figure>

<p><br /></p>

<p>To use our <code class="highlighter-rouge">AdminView</code> class, we have to tell Flask-Admin about it in <strong>votr.py</strong>.</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask_admin</span> <span class="kn">import</span> <span class="n">Admin</span>
<span class="kn">from</span> <span class="nn">admin</span> <span class="kn">import</span> <span class="n">AdminView</span>

<span class="n">votr</span> <span class="o">=</span> <span class="n">Flask</span><span class="p">(</span><span class="n">__name__</span><span class="p">)</span>

<span class="c"># load config from the config file we created earlier</span>
<span class="n">votr</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">from_object</span><span class="p">(</span><span class="s">'config'</span><span class="p">)</span>

<span class="c"># create the database</span>
<span class="n">db</span><span class="o">.</span><span class="n">init_app</span><span class="p">(</span><span class="n">votr</span><span class="p">)</span>
<span class="c"># db.create_all(app=votr)</span>

<span class="n">migrate</span> <span class="o">=</span> <span class="n">Migrate</span><span class="p">(</span><span class="n">votr</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">render_as_batch</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">admin</span> <span class="o">=</span> <span class="n">Admin</span><span class="p">(</span><span class="n">votr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'Dashboard'</span><span class="p">,</span> <span class="n">index_view</span><span class="o">=</span><span class="n">AdminView</span><span class="p">(</span><span class="n">Topics</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">'/admin'</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s">'admin'</span><span class="p">))</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">AdminView</span><span class="p">(</span><span class="n">Users</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">))</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">AdminView</span><span class="p">(</span><span class="n">Polls</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">))</span>
<span class="n">admin</span><span class="o">.</span><span class="n">add_view</span><span class="p">(</span><span class="n">AdminView</span><span class="p">(</span><span class="n">Options</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">))</span></code></pre></figure>

<p>The important line here is:</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">admin</span> <span class="o">=</span> <span class="n">Admin</span><span class="p">(</span><span class="n">votr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'Dashboard'</span><span class="p">,</span> <span class="n">index_view</span><span class="o">=</span><span class="n">AdminView</span><span class="p">(</span><span class="n">Topics</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">'/admin'</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s">'admin'</span><span class="p">))</span></code></pre></figure>

<p>specifically the <code class="highlighter-rouge">index_view</code> argument, we’re telling flask admin that we want the <strong>Topics</strong> model to serve as the default view for our application instead of the blank home page and then we also specified that the url for the <code class="highlighter-rouge">Topic</code> model should be <code class="highlighter-rouge">http[s]://hostname:port/admin</code> instead of the default <code class="highlighter-rouge">http[s]://hostname:port/admin/topics</code></p>

<p>Finally we’re setting the <code class="highlighter-rouge">endpoint</code> to <strong>admin</strong></p>

<p>That’s all!, with this information flask admin is able to build the blueprints with our models (<em>Internally flask admin uses introspection to get the details about the models passed to it and creates blueprints on the fly</em>)</p>

<p>Flask admin should be protected from others whose username doesn’t equal <strong>Administrator</strong>. Our username field is actually unique, so this means that we only have one admin user.</p>

<p>If you want to add other admin users, you can add more usernames to check for in the <code class="highlighter-rouge">is_accessible</code> method or better still add a boolean field to your user model to determine if the user is an admin user or not. I’ll leave you to your imagination here</p>

<p><br /></p>

<h3 id="protecting-the-polls-from-multiple-votes">Protecting the polls from multiple votes</h3>
<p>In the last part, we talked about prevent users from voting multiple times, to do this we’ll have to add a new model to track a user and the polls he has voted on, and then on every request <code class="highlighter-rouge">/api/vote</code> we can simply check if he’s voted on that poll before and then abort the request with a custom message or allow the request like we’ve always done</p>

<p><strong>Add a new model called UserPolls in votr.py</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">UserPolls</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>

    <span class="n">topic_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">'topics.id'</span><span class="p">))</span>
    <span class="n">user_id</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Integer</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">'users.id'</span><span class="p">))</span>

    <span class="n">topics</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s">'Topics'</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">topic_id</span><span class="p">],</span>
                             <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s">'voted_on_by'</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s">'dynamic'</span><span class="p">))</span>

    <span class="n">users</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s">'Users'</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">user_id</span><span class="p">],</span>
                            <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s">'voted_on'</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s">'dynamic'</span><span class="p">))</span></code></pre></figure>

<p>after doing that run the <a href="/2016/10/05/flask-by-example-5.html">migrations and upgrade the database</a></p>

<p><strong>IMPORTANT: before running the migrations, make sure you comment out the <code class="highlighter-rouge">db.create_all</code> in <code class="highlighter-rouge">votr.py</code> if you don’t SQLAlchemy would create the new table from you and Alembic won’t be able to detect any change in the database schema</strong></p>

<p><strong>Modify the /api/vote endpoint to incorporate the new changes</strong></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="nd">@votr.route</span><span class="p">(</span><span class="s">'/api/poll/vote'</span><span class="p">,</span> <span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s">'PATCH'</span><span class="p">])</span>
<span class="k">def</span> <span class="nf">api_poll_vote</span><span class="p">():</span>
    <span class="n">poll</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>

    <span class="n">poll_title</span><span class="p">,</span> <span class="n">option</span> <span class="o">=</span> <span class="p">(</span><span class="n">poll</span><span class="p">[</span><span class="s">'poll_title'</span><span class="p">],</span> <span class="n">poll</span><span class="p">[</span><span class="s">'option'</span><span class="p">])</span>

    <span class="n">join_tables</span> <span class="o">=</span> <span class="n">Polls</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Topics</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">Options</span><span class="p">)</span>

    <span class="c"># Get topic and username from the database</span>
    <span class="n">topic</span> <span class="o">=</span> <span class="n">Topics</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">poll_title</span><span class="p">)</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">Users</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="n">session</span><span class="p">[</span><span class="s">'user'</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="c"># filter options</span>
    <span class="n">option</span> <span class="o">=</span> <span class="n">join_tables</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Topics</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="n">poll_title</span><span class="p">))</span><span class="o">.</span><span class="nb">filter</span><span class="p">(</span><span class="n">Options</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">like</span><span class="p">(</span><span class="n">option</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

    <span class="c"># check if the user has voted on this poll</span>
    <span class="n">poll_count</span> <span class="o">=</span> <span class="n">UserPolls</span><span class="o">.</span><span class="n">query</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">topic_id</span><span class="o">=</span><span class="n">topic</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span><span class="n">user_id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">poll_count</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">'message'</span><span class="p">:</span> <span class="s">'Sorry! multiple votes are not allowed'</span><span class="p">})</span>

    <span class="k">if</span> <span class="n">option</span><span class="p">:</span>
        <span class="c"># record user and poll</span>
        <span class="n">user_poll</span> <span class="o">=</span> <span class="n">UserPolls</span><span class="p">(</span><span class="n">topic_id</span><span class="o">=</span><span class="n">topic</span><span class="o">.</span><span class="nb">id</span><span class="p">,</span> <span class="n">user_id</span><span class="o">=</span><span class="n">user</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">user_poll</span><span class="p">)</span>

        <span class="c"># increment vote_count by 1 if the option was found</span>
        <span class="n">option</span><span class="o">.</span><span class="n">vote_count</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">'message'</span><span class="p">:</span> <span class="s">'Thank you for voting'</span><span class="p">})</span>

    <span class="k">return</span> <span class="n">jsonify</span><span class="p">({</span><span class="s">'message'</span><span class="p">:</span> <span class="s">'option or poll was not found please try again'</span><span class="p">})</span></code></pre></figure>

<p>That’s all, a user shouldn’t be able to vote on a poll more than once, if they try that they should see a popup in their browser telling them that multiple votes are not allowed</p>

<p><br /></p>

<h3 id="customizing-flask-admin">Customizing Flask-Admin</h3>
<p>Out of the box, flask admin gives us a pretty usable interface and reasonable defaults, but that doesn’t mean it’s not flexible. flask admin customize it and add extra behaviour, flask admin allows us make different enhancements ranging from ui enhancements (Search boxes, filters) to behavioural enhancements.</p>

<p>We’re going to add some new features to the admin page</p>

<ul class="postlist">

  <li>A search box to search for poll by their title</li>

  <li>A filter to show opened/closed polls</li>

  <li>Sort the Topics by the date they were created</li>

  <li>Add a filter on the status field so we can see all open or closed polls at any point in time</li>

  <li>Change the default date format to something more readable</li>

  <li>Display the total vote count for each topic and make the topics sortable with it</li>

</ul>

<p><br /></p>

<p>The first four options added easily</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="k">class</span> <span class="nc">TopicView</span><span class="p">(</span><span class="n">AdminView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TopicView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="n">column_list</span> <span class="o">=</span> <span class="p">(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'date_created'</span><span class="p">,</span> <span class="s">'date_modified'</span><span class="p">,</span> <span class="s">'status'</span><span class="p">)</span>
    <span class="n">column_searchable_list</span> <span class="o">=</span> <span class="p">(</span><span class="s">'title'</span><span class="p">,)</span>
    <span class="n">column_default_sort</span> <span class="o">=</span> <span class="p">(</span><span class="s">'date_created'</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
    <span class="n">column_filters</span> <span class="o">=</span> <span class="p">(</span><span class="s">'status'</span><span class="p">,)</span></code></pre></figure>

<p><strong><u>column_list:</u></strong> This is used to list the various columns in the order you want them</p>

<p><strong><u>column_searchable_list:</u></strong> Columns that you want to be searchable in the model</p>

<p><strong><u>column_default_sort:</u></strong> The column that the view should be sorted with by default (when the view is loaded for the first time). The second parameter <code class="highlighter-rouge">True</code> tells flask-admin to sort it in descending order</p>

<p><strong><u>column_filters:</u></strong> List of columns that can be used to filter</p>

<p>Notice that we created a new class, so let’s change the <code class="highlighter-rouge">index_view</code> argument for the <code class="highlighter-rouge">Admin</code> object in <strong>votr.py</strong> to use our new class</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># new top level imports</span>
<span class="kn">from</span> <span class="nn">admin</span> <span class="kn">import</span> <span class="n">AdminView</span><span class="p">,</span> <span class="n">TopicView</span>


<span class="n">admin</span> <span class="o">=</span> <span class="n">Admin</span><span class="p">(</span><span class="n">votr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s">'Dashboard'</span><span class="p">,</span> <span class="n">index_view</span><span class="o">=</span><span class="n">TopicView</span><span class="p">(</span><span class="n">Topics</span><span class="p">,</span> <span class="n">db</span><span class="o">.</span><span class="n">session</span><span class="p">,</span> <span class="n">url</span><span class="o">=</span><span class="s">'/admin'</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="s">'admin'</span><span class="p">))</span></code></pre></figure>

<p>That’s it, reload the admin page and you should see the new changes in effect</p>

<p><img src="/images/flask-7-customize1.png" alt="flask-7-customize1" /></p>

<p>With some simple variables, we’ve been able to add some customization to our admin interface.</p>

<p>The last two customizations are not as straight-forward, but they aren’t too complex either</p>

<p>The following code is used to change the date format</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="kn">from</span> <span class="nn">flask_admin.contrib.sqla</span> <span class="kn">import</span> <span class="n">ModelView</span>
<span class="kn">from</span> <span class="nn">flask</span> <span class="kn">import</span> <span class="n">session</span><span class="p">,</span> <span class="n">redirect</span><span class="p">,</span> <span class="n">url_for</span><span class="p">,</span> <span class="n">request</span>
<span class="kn">from</span> <span class="nn">flask_admin.model</span> <span class="kn">import</span> <span class="n">typefmt</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>

<span class="k">class</span> <span class="nc">AdminView</span><span class="p">(</span><span class="n">ModelView</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">AdminView</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">static_folder</span> <span class="o">=</span> <span class="s">'static'</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">column_formatters</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">typefmt</span><span class="o">.</span><span class="n">BASE_FORMATTERS</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">column_formatters</span><span class="o">.</span><span class="n">update</span><span class="p">({</span>
                <span class="nb">type</span><span class="p">(</span><span class="bp">None</span><span class="p">):</span> <span class="n">typefmt</span><span class="o">.</span><span class="n">null_formatter</span><span class="p">,</span>
                <span class="n">datetime</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">date_format</span>
            <span class="p">})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">column_type_formatters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">column_formatters</span>

    <span class="k">def</span> <span class="nf">date_format</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">view</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
          <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s">'</span><span class="si">%</span><span class="s">B-</span><span class="si">%</span><span class="s">m-</span><span class="si">%</span><span class="s">Y </span><span class="si">%</span><span class="s">I:</span><span class="si">%</span><span class="s">M:</span><span class="si">%</span><span class="s">p'</span><span class="p">)</span></code></pre></figure>

<p>We put it in the constructor of <code class="highlighter-rouge">AdminView</code> because we want to re-use this date format in all our models including <code class="highlighter-rouge">Topics</code> which already inherits from <code class="highlighter-rouge">AdminView</code></p>

<p>You should also note that we can define flask admin variables as class variables like we did for the first four customizations or as instance variables like we’re doing  with <code class="highlighter-rouge">self.column_type_formatters</code>. so if you don’t need it in the constructor <code class="highlighter-rouge">column_type_formatters</code> is just fine</p>

<p><code class="highlighter-rouge">column_formatters</code> expects a dictionary of Object types as the key and the corresponding display value we want as the value</p>

<p><code class="highlighter-rouge">typefmt.BASE_FORMATTERS</code> provides sane defaults for the various types of field formatters our model should have this list includes formatters for <code class="highlighter-rouge">lists</code>, <code class="highlighter-rouge">dicts</code>, <code class="highlighter-rouge">bools</code> and other python data types.</p>

<p>We simply updated the dictionary with our own custom format for datetime objects and left the rest to flask admin</p>

<p>To accomplish the last improvement, We have to make use of a feature in SQLAlchemy called <a href="http://docs.sqlalchemy.org/en/latest/orm/extensions/hybrid.html">hybrid_property</a></p>

<p>A <code class="highlighter-rouge">hybrid_property</code> can be thought of as a computable column. At the database layer the column doesn’t exist but we can use it <strong><em>almost</em></strong> like we use other columns in our model.</p>

<p>Let’s modify the <code class="highlighter-rouge">Topics</code> model in the <strong>models.py</strong> file</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="c"># new top level imports</span>
<span class="kn">from</span> <span class="nn">sqlalchemy.ext.hybrid</span> <span class="kn">import</span> <span class="n">hybrid_property</span>
<span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">select</span><span class="p">,</span> <span class="n">func</span>

<span class="c"># Model for poll topics</span>
<span class="k">class</span> <span class="nc">Topics</span><span class="p">(</span><span class="n">Base</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="mi">500</span><span class="p">))</span>
    <span class="n">status</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">Boolean</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># to mark poll as open or closed</span>
    <span class="n">create_uid</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">Column</span><span class="p">(</span><span class="n">db</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">'users.id'</span><span class="p">))</span>

    <span class="n">created_by</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">relationship</span><span class="p">(</span><span class="s">'Users'</span><span class="p">,</span> <span class="n">foreign_keys</span><span class="o">=</span><span class="p">[</span><span class="n">create_uid</span><span class="p">],</span>
                                 <span class="n">backref</span><span class="o">=</span><span class="n">db</span><span class="o">.</span><span class="n">backref</span><span class="p">(</span><span class="s">'user_polls'</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s">'dynamic'</span><span class="p">))</span>

    <span class="c"># user friendly way to display the object</span>
    <span class="k">def</span> <span class="nf">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span>

    <span class="c"># returns dictionary that can easily be jsonified</span>
    <span class="k">def</span> <span class="nf">to_json</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">{</span>
                <span class="s">'title'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span>
                <span class="s">'options'</span><span class="p">:</span> <span class="p">[{</span><span class="s">'name'</span><span class="p">:</span> <span class="n">option</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="s">'vote_count'</span><span class="p">:</span> <span class="n">option</span><span class="o">.</span><span class="n">vote_count</span><span class="p">}</span>
                            <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="nb">all</span><span class="p">()],</span>
                <span class="s">'status'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span><span class="p">,</span>
                <span class="s">'total_vote_count'</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">total_vote_count</span>
            <span class="p">}</span>

    <span class="nd">@hybrid_property</span>
    <span class="k">def</span> <span class="nf">total_vote_count</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">total</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">option</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="nb">all</span><span class="p">():</span>
            <span class="n">total</span> <span class="o">+=</span> <span class="n">option</span><span class="o">.</span><span class="n">vote_count</span>

        <span class="k">return</span> <span class="n">total</span>

    <span class="nd">@total_vote_count.expression</span>
    <span class="k">def</span> <span class="nf">total_vote_count</span><span class="p">(</span><span class="n">cls</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">select</span><span class="p">([</span><span class="n">func</span><span class="o">.</span><span class="nb">sum</span><span class="p">(</span><span class="n">Polls</span><span class="o">.</span><span class="n">vote_count</span><span class="p">)])</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Polls</span><span class="o">.</span><span class="n">topic_id</span> <span class="o">==</span> <span class="n">cls</span><span class="o">.</span><span class="nb">id</span><span class="p">)</span></code></pre></figure>

<p>The <code class="highlighter-rouge">hybrid_property</code> decorator tells SQLAlchemy that we want to use the return value of <code class="highlighter-rouge">total_vote_count</code> as a column of the model not just a plain property of the class</p>

<p>The key part of the hybrid_property is the the decorator <code class="highlighter-rouge">@total_vote_count.expression</code>. Depending on how complex the <code class="highlighter-rouge">hybrid_property</code> is and how we compute the values, we might need a <code class="highlighter-rouge">hybrid_property</code> expression (<em>For simple computed values based on fields of the model it’s not necessary, flask-admin can figure out how to sort the column</em>)</p>

<p>The expression must return <code class="highlighter-rouge">SQL</code> that would be used by flask-admin to sort the column properly, if you don’t need the sorting you can just leave out the expression part.</p>

<p>So this this case we’re returning SQL that’s similar to this:</p>

<figure class="highlight"><pre><code class="language-sql" data-lang="sql"><span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="n">polls</span><span class="p">.</span><span class="n">vote_count</span><span class="p">)</span> <span class="k">AS</span> <span class="n">sum_1</span> <span class="k">FROM</span> <span class="n">polls</span><span class="p">,</span> <span class="n">topics</span> <span class="k">WHERE</span> <span class="n">polls</span><span class="p">.</span><span class="n">topic_id</span> <span class="o">=</span> <span class="n">topics</span><span class="p">.</span><span class="n">id</span></code></pre></figure>

<p>So with that information, flask-admin would be able to sort the total_vote_count column with it’s total votes</p>

<p>Don’t forget to add this to the <code class="highlighter-rouge">TopicView</code> class in <code class="highlighter-rouge">admin.py</code></p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">column_sortable_list</span> <span class="o">=</span> <span class="p">(</span><span class="s">'total_vote_count'</span><span class="p">,)</span></code></pre></figure>

<p>and modify <code class="highlighter-rouge">colum_list</code> to show the new column</p>

<figure class="highlight"><pre><code class="language-python" data-lang="python"><span class="n">column_list</span> <span class="o">=</span> <span class="p">(</span><span class="s">'title'</span><span class="p">,</span> <span class="s">'date_created'</span><span class="p">,</span> <span class="s">'date_modified'</span><span class="p">,</span> <span class="s">'total_vote_count'</span><span class="p">,</span> <span class="s">'status'</span><span class="p">)</span></code></pre></figure>

<p>We also modified the <code class="highlighter-rouge">to_json</code> method of the model to use the new <code class="highlighter-rouge">total_vote_count</code> property</p>

<p><br />
We’ve come to the end of this part, this post was a gentle introduction to flask-admin and what you can do with it.
you also saw how you can restrict each user to a single vote on a poll.</p>

<p>Everything about flask admin is customizable, to keep this tutorial brief i didn’t talk about customizing the templates but if you’re wondering how “customizable” flask admin templates are here are two screenshots of an admin dashboard built with flask admin.</p>

<p><img src="http://mrjoes.github.io/shared/posts/flask-admin-120/cb1.jpg" alt="flask admin dashboard" /></p>

<p><img src="http://mrjoes.github.io/shared/posts/flask-admin-120/cb3.jpg" alt="flask admin dashboard2" /></p>

<p>There’s a so much to explore. <a href="https://github.com/mrjoes/flask-admin/tree/master/examples/rediscli">Redis CLI</a> is even integrated with flask admin!.</p>

<p><strong><em>Now that you know about flask admin, try to resist the urge to use it for your general/public user’s admin dashboard. If you know 101% of what you’re doing, there’s actually nothing wrong with using it, but have it at the back of your head that you’ll probably spend more time customizing flask admin compared to the time you’ll spend rolling your own admin dashboard from scratch.</em></strong></p>

<p><strong><em>You also run the risk of users gaining access or seeing things they aren’t supposed to see.</em></strong></p>

<p><strong><em>Flask admin is more suitable for admins or users that you can trust</em></strong></p>

<p>In the next part, we’re going to talk about flask blueprints, when and why you should use them in your flask application. see you there!</p>

            </div>

            <br />

            <hr>

            <div class="share-page">
                Share this post on &rarr;
                <a href="https://twitter.com/intent/tweet?text=Flask by example 7 (Spin up an Admin dashboard quickly and easily with Flask-Admin)&url=http://localhost:4000/2016/11/14/flask-by-example-7.html&via=osaetindaniel&related=osaetindaniel" rel="nofollow" target="_blank" title="Share on Twitter">Twitter</a> |
                <a href="https://facebook.com/sharer.php?u=http://localhost:4000/2016/11/14/flask-by-example-7.html" rel="nofollow" target="_blank" title="Share on Facebook">Facebook</a> |
                <a href="https://plus.google.com/share?url=http://localhost:4000/2016/11/14/flask-by-example-7.html" rel="nofollow" target="_blank" title="Share on Google+">Google+</a>
            </div>

        <hr>

        <aside id="comments" class="disqus">
          <div class="container">
            <h3><i class="fa fa-comments-o"></i> Comments</h3>
            <div id="disqus_thread"></div>
            <script>



              var disqus_config = function() {
                this.page.url = 'https://danidee10.github.io/2016/11/14/flask-by-example-7.html'; //shouldn't hardoce this
                this.page.identifier = 'Flask by example 7 (Spin up an Admin dashboard quickly and easily with Flask-Admin)';
              };
              (function() {
                var d = document,
                s = d.createElement('script');
                s.src = '//osaetin-daniel.disqus.com/embed.js';
                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
              })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
          </div>
        </aside>

          </div>

        </article>

      </div>

      <footer class="site-footer">
  <div class="container">
    <ul class="social">
      <li><a href="http://github.com/danidee10" target="_blank"><i class="fa fa-github"></i></a></li>
      <li><a href="http://twitter.com/osaetindaniel" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
      <li><a href="https://www.facebook.com/osaetin.daniel" target="_blank"><i class="fa fa-facebook"></i></a></li>
      <li><a href="https://www.linkedin.com/in/osaetin-daniel-87604098" target="_blank"><i class="fa fa-linkedin"></i></a></li>
    </ul>
    <p class="txt-medium-gray">
      <small>&copy;2016 All rights reserved. Made with <a href="http://jekyllrb.com/" target="_blank">Jekyll</a> and ♥</small>
    </p>
  </div>
</footer>


<a href="https://github.com/danidee10" target="_blank" class="github-corner"><svg width="50" height="50" viewBox="0 0 250 250" style="fill:#337ab7; color:#fff; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<script src="//code.jquery.com/jquery-1.11.3.min.js"></script>
<script>
$(document).ready(function() {
  $('.sliding-panel-button,.sliding-panel-fade-screen,.sliding-panel-close').on('click touchstart',function (e) {
    $('.sliding-panel-content,.sliding-panel-fade-screen').toggleClass('is-visible');
    e.preventDefault();
  });
});
</script>

    </main>
  </body>
</html>
